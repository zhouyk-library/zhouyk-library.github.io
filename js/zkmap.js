!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("zkmap",[],e):"object"==typeof exports?exports.zkmap=e():t.zkmap=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&n(e,t,r);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});var a=o(r(13)),s=o(r(14)),u=o(r(15)),c=o(r(16)),h=o(r(17)),l=o(r(19)),f=o(r(20));e.default={Matrix2D:a,Browser:s,Objects:u,DOM:c,Math:h,Number:l,Canvas2D:f}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ScrollHandler=e.MouseHandler=e.EventHandlerManager=e.Evented=e.ErrorEvent=e.Event=void 0;var i=n(r(12));e.Event=i.default;var o=n(r(21));e.ErrorEvent=o.default;var a=n(r(22));e.Evented=a.default;var s=n(r(23));e.EventHandlerManager=s.default;var u=n(r(24));e.MouseHandler=u.default;var c=n(r(25));e.ScrollHandler=c.default},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Point=e.Bound=e.Constant=e.WebMercator=e.Transform=e.LngLat=void 0;var i=n(r(26));e.LngLat=i.default;var o=n(r(27));e.Transform=o.default;var a=n(r(30));e.WebMercator=a.default;var s=n(r(31));e.Bound=s.default;var u=n(r(5));e.Constant=u.default;var c=n(r(4));e.Point=c.default},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.TileState=e.Sources=e.RasterTile=e.TilesCache=e.RasterSource=void 0;var i=n(r(32));e.RasterSource=i.default;var o=n(r(34));e.Sources=o.default;var a=n(r(35));e.TilesCache=a.default;var s=n(r(36));e.RasterTile=s.default,function(t){t[t.NONE=0]="NONE",t[t.LOADING=2]="LOADING",t[t.OK=1]="OK",t[t.ERROR=-1]="ERROR"}(e.TileState||(e.TileState={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!1,configurable:!0}),t.prototype.toArray=function(){return[this._x,this._y]},t.prototype.clone=function(){return new t(this._x,this._y)},t.prototype.add=function(t){return this.clone()._add(t)},t.prototype.sub=function(t){return this.clone()._sub(t)},t.prototype.multByPoint=function(t){return this.clone()._multByPoint(t)},t.prototype.mult=function(t){return this.clone()._mult(t)},t.prototype.divByPoint=function(t){return this.clone()._divByPoint(t)},t.prototype.div=function(t){return this.clone()._div(t)},t.prototype.rotate=function(t){return this.clone()._rotate(t)},t.prototype.rotateAround=function(t,e){return this.clone()._rotateAround(t,e)},t.prototype.matMult=function(t){return this.clone()._matMult(t)},t.prototype.unit=function(){return this.clone()._unit()},t.prototype.perp=function(){return this.clone()._perp()},t.prototype.round=function(){return this.clone()._round()},t.prototype.mag=function(){return this._x*this._x+this._y*this._y},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.dist=function(t){return Math.sqrt(this.distSqr(t))},t.prototype.distSqr=function(t){return Math.pow(t.x-this.x,2)*Math.pow(t.y-this.y,2)},t.prototype.angle=function(){return Math.atan2(this.y,this.x)},t.prototype.angleTo=function(t){return Math.atan2(this.y-t.y,this.x-t.x)},t.prototype.angleWith=function(t){return this.angleWithSep(t.x,t.y)},t.prototype.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},t.prototype._matMult=function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this._x=e,this._y=r,this},t.prototype._add=function(t){return this._x+=t.x,this._y+=t.y,this},t.prototype._sub=function(t){return this._x-=t.x,this._y-=t.y,this},t.prototype._mult=function(t){return this._x*=t,this._y*=t,this},t.prototype._div=function(t){return this._x/=t,this._y/=t,this},t.prototype._multByPoint=function(t){return this._x*=t.x,this._y*=t.y,this},t.prototype._divByPoint=function(t){return this._x/=t.x,this._y/=t.y,this},t.prototype._unit=function(){return this._div(this.mag()),this},t.prototype._perp=function(){var t=this.y;return this._y=this._x,this._x=-t,this},t.prototype._rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this._x-r*this._y,i=r*this._x+e*this._y;return this._x=n,this._y=i,this},t.prototype._rotateAround=function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.x+r*(this._x-e.x)-n*(this._y-e.y),o=e.y+n*(this._x-e.x)+r*(this._y-e.y);return this._x=i,this._y=o,this},t.prototype._round=function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={minZoom:0,maxZoom:0,maxValidLatitude:85.05112877980659,maxValidlongitude:180,maxMercator:20037508.3427892,tileSize:256,earthRadius:6371008.8}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Painter=e.Context=void 0;var i=n(r(28));e.Context=i.default;var o=n(r(29));e.Painter=o.default},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.URL=void 0;var i=n(r(33));e.URL=i.default},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PointLayer=e.RasterDebuggerLayer=e.Layers=e.RasterLayer=void 0;var i=n(r(37));e.RasterLayer=i.default;var o=n(r(38));e.PointLayer=o.default;var a=n(r(39));e.RasterDebuggerLayer=a.default;var s=n(r(40));e.Layers=s.default},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var i=n(r(10));e.Map=i.default,e.default={Map:i.default}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(r(11)),s=r(1),u=r(3),c=r(8),h=r(2),l=r(41),f=r(7),d=r(6),_=o(r(0)),p=function(t){function e(e){var r=this;if(null!=e.minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");Number.isInteger(e.minZoom)&&Number.isInteger(e.maxZoom)||(e.minZoom=0,e.maxZoom=22);var n=null;if("string"==typeof e.container){if(!(n=window.document.getElementById(e.container)))throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");n=e.container}if(!e.source||0===e.source.length)throw new Error("[ERROR]:source is empty");if(!e.layer||0===e.layer.length)throw new Error("[ERROR]:layer is empty");var i=_.default.DOM.create("div",void 0,"touch-action: none;cursor: grab;user-select: none;",n),o=_.default.DOM.create("canvas",void 0,"position: absolute;left: 0;top: 0;",i);o.width=n.clientWidth,o.height=n.clientHeight,n.appendChild(i);var a=new h.Transform(o,e.minZoom,e.maxZoom,e.type);return(r=t.call(this,a)||this)._painter=new d.Painter(a.context.ctx,r),r._url=new f.URL("",""),r._sources=new u.Sources,r._layers=new c.Layers(r._sources,r),e.source.forEach((function(t){r.addSource(t)})),e.layer.forEach((function(t){r.addLayer(t)})),r._options=e,r._renderTaskQueue=new l.TaskQueue,r._canvas=o,r._container=n,r._canvasContainer=i,r._eventHandlerManager=new s.EventHandlerManager(r),r.resize(),r.triggerRepaint(),r.on("refresh",r.triggerRepaint),r}return i(e,t),e.prototype.getUrl=function(t,e,r){return this._url.getUrl(t,e,r)},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.resize=function(t){this.transform.resize(this._container.clientWidth,this._container.clientHeight)},e.prototype.addSource=function(t){return this._sources.addCreatSource(t),t.id},e.prototype.removeSource=function(t){this._sources.remove(t)},e.prototype.addLayer=function(t,e){return this._layers.addCreatLayer(t,e),t.id},e.prototype.removeLayer=function(t){this._layers.remove(t)},e.prototype._requestRenderFrame=function(t){return this._renderTaskQueue.add(t)},e.prototype.triggerRepaint=function(){var t=this;this._animationFrame&&this._animationFrame.cancel&&this._animationFrame.cancel(),this._animationFrame=_.default.Browser.requestAnimationFrame((function(e){return t._animationFrame=null,t._renderTaskQueue.run(),t._layers.render(),t._layers.draw(),t.triggerRepaint(),t}))},e}(a.default);e.default=p},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e){var r=t.call(this)||this;return r.transform=e,r}return i(e,t),e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t){this.transform.center=t},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t){this.transform.zoom=t},e}(r(1).Evented);e.default=o},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(0)),o=function(){function t(t,e){void 0===e&&(e={}),i.default.Objects.extend(this,e),this._type=t}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!1,configurable:!0}),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.invert=e.makeInverse=e.isCanInvert=e.determinant=e.composeCssTransform=e.compose=e.translate=e.scale=e.rotate=e.invertTransform=e.transform=e.setFromArray=e.multiply=e.reset=e.makeScale=e.set=e.toCssString=e.matrixToArray=e.create=void 0;var n=new Array(6);function i(){return Array.from([1,0,0,1,0,0])}function o(t){return"matrix("+t.join(", ")+")"}function a(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function s(t,e,r){return a(t,e,0,0,r,0,0)}function u(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=e[0],c=e[1],h=e[2],l=e[3],f=e[4],d=e[5];return t[0]=r*u+i*c,t[1]=n*u+o*c,t[2]=r*h+i*l,t[3]=n*h+o*l,t[4]=r*f+i*d+a,t[5]=n*f+o*d+s,t}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function h(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function l(t,e,r,n,i,o,a,s){var u=Math.sin(o),c=Math.cos(o);return t[0]=n*c,t[1]=i*u,t[2]=-n*u,t[3]=i*c,t[4]=a*n*c-s*n*u+e,t[5]=a*i*u+s*i*c+r,t}function f(t){return t[0]*t[3]-t[1]*t[2]}function d(t,e){var r=f(e),n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5];return t[0]=a/r,t[1]=-i/r,t[2]=-o/r,t[3]=n/r,t[4]=(o*u-a*s)/r,t[5]=-(n*u-i*s)/r,t}function _(t){return d(t,t)}e.create=i,e.matrixToArray=function(t){return Array.from([t.a,t.b,t.c,t.d,t.e,t.f])},e.toCssString=o,e.set=a,e.makeScale=s,e.reset=function(t){return a(t,1,0,0,1,0,0)},e.multiply=u,e.setFromArray=c,e.transform=h,e.invertTransform=function(t,e){return h(_(c(n,t)),e)},e.rotate=function(t,e){var r=Math.cos(e),i=Math.sin(e);return u(t,a(n,r,i,-i,r,0,0))},e.scale=function(t,e,r){return u(t,s(n,e,r))},e.translate=function(t,e,r){return u(t,a(n,1,0,0,1,e,r))},e.compose=l,e.composeCssTransform=function(t,e,r,n,a,s,u){return o(l(i(),t,e,r,n,a,s,u))},e.determinant=f,e.isCanInvert=function(t){return 0!=f(t)},e.makeInverse=d,e.invert=_},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.now=e.offscreenCanvasSupported=e.requestAnimationFrame=void 0;var n,i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;e.requestAnimationFrame=function(t){var e=i(t);return{cancel:function(){return o(e)}}},e.offscreenCanvasSupported=function(){return null==n&&(n=window.OffscreenCanvas&&new window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof window.createImageBitmap),n},e.now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isNil=e.bindAll=e.extend=void 0,e.extend=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=0,i=e;n<i.length;n++){var o=i[n];for(var a in o)t[a]=o[a]}return t},e.bindAll=function(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))},e.isNil=function(t){return null==t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeEventListener=e.addEventListener=e.create=void 0,e.create=function(t,e,r,n){var i=window.document.createElement(t);return void 0!==e&&(i.className=e),void 0!==r&&(i.style.cssText=r),n&&n.appendChild(i),i},e.addEventListener=function(t,e,r,n){void 0===n&&(n={}),"passive"in n?t.addEventListener(e,r,n):t.addEventListener(e,r,n.capture)},e.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),"passive"in n?t.removeEventListener(e,r,n):t.removeEventListener(e,r,n.capture)}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ease=e.bezier=void 0;var i=n(r(18));function o(t,e,r,n){var o=new i.default(t,e,r,n);return function(t){return o.solve(t)}}e.bezier=o,e.ease=o(.25,.1,.25,1)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by}return t.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},t.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},t.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},t.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if(i<r)return r;if(i>n)return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-i)<1e-6)return i;i>o?r=i:n=i,i=.5*(n-r)+r}return i},t.prototype.solve=function(t){return this.sampleCurveY(this.solveCurveX(t))},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isInteger=e.isNumber=void 0,e.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},e.isInteger=function(t){return(0|t)===t}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.image=e.clearRect=e.createCanvas=void 0;var i=n(r(0));e.createCanvas=function(t,e,r){var n;return r?n=new r(t,e):((n=i.default.DOM.create("canvas")).width=t,n.height=e),n},e.clearRect=function(t,e,r,n,i){t.clearRect(e,r,n,i)},e.image=function(t,e,r,n,o,a){try{i.default.Number.isNumber(o)&&i.default.Number.isNumber(a)?t.drawImage(e,r,n,o,a):t.drawImage(e,r,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(1),s=o(r(0)),u=function(t){function e(e,r){return void 0===r&&(r={}),t.call(this,"error",s.default.Objects.extend({error:e},r))||this}return i(e,t),e}(a.Event);e.default=u},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(0)),o=r(1),a=function(){function t(){}return t._addEventListener=function(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))},t._removeEventListener=function(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}},t.prototype.on=function(e,r){return this._listeners=this._listeners||{},t._addEventListener(e,r,this._listeners),this},t.prototype.off=function(e,r){return t._removeEventListener(e,r,this._listeners),t._removeEventListener(e,r,this._oneTimeListeners),this},t.prototype.once=function(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},t._addEventListener(e,r,this._oneTimeListeners),this},t.prototype.fire=function(e,r){"string"==typeof e&&(e=new o.Event(e,r||{}));var n=e.type;if(this.listens(n)){e.target=this;for(var a=0,s=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];a<s.length;a++){(h=s[a]).call(this,e)}for(var u=0,c=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];u<c.length;u++){var h=c[u];t._removeEventListener(n,h,this._oneTimeListeners),h.call(this,e)}var l=this._eventedParent;l&&(i.default.Objects.extend(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(e))}else e instanceof ErrorEvent&&console.error(e.error);return this},t.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},t.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this},t}();e.default=a},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=n(r(0)),a=n(r(4)),s=function(){function t(t){this._handlers=new Array,this._map=t;var e=this._el=this._map.getCanvasContainer();this.initDefaultHandlers(),this._listeners=[[e,"mousedown",void 0],[e,"mousemove",void 0],[e,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[e,"mouseover",void 0],[e,"mouseout",void 0],[e,"dblclick",void 0],[e,"click",void 0],[e,"keydown",{capture:!1}],[e,"keyup",void 0],[e,"wheel",{passive:!1}],[window,"blur",void 0]];for(var r=0,n=this._listeners;r<n.length;r++){var i=n[r],a=i[0],s=i[1],u=i[2];o.default.DOM.addEventListener(a,s,this.handleEvent.bind(this),u)}}return t.prototype.handleEvent=function(t){var e=t.type;"blur"!==e?this.computedRenderFrame(t,e):this.stop()},t.prototype.initDefaultHandlers=function(){this.addHandler("scrollZoom",new i.ScrollHandler(this._map,this),["wheel"]),this.addHandler("mousePan",new i.MouseHandler(this._map,this),["mousemove","mouseup","mousedown"]);for(var t=0,e=this._handlers;t<e.length;t++){e[t].handler.enable()}},t.prototype.addHandler=function(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r})},t.prototype.stop=function(){for(var t=0,e=this._handlers;t<e.length;t++){e[t].handler.reset()}},t.prototype.computedRenderFrame=function(t,e,r){for(var n=new a.default(t.x,t.y),i=0,o=this._handlers;i<o.length;i++){var s=o[i],u=(s.handlerName,s.handler);s.allowed;if(u.isEnabled()){var c=void 0;u[e]&&(c=u[e](t,n))&&(c.around&&(this._map.transform.anchorPoint=c.around.toArray()),c.targetZoom&&(this._map.transform.zoom=c.targetZoom),c.dragDelta&&this._map.transform.moveCenter(c.dragDelta.toArray()),c.renderFrame&&this.triggerRenderFrame())}}},t.prototype.updateTransform=function(t){},t.prototype.triggerRenderFrame=function(){var t=this;void 0===this._frameId&&(this._frameId=this._map._requestRenderFrame((function(e){delete t._frameId,t.computedRenderFrame({},"renderFrame",e),t.updateTransform(e)})))},t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._map=t,this._handler=e}return t.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},t.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},t.prototype.isEnabled=function(){return!!this._enabled},t.prototype.isActive=function(){return this._active},t.prototype.reset=function(){this._active=!1,delete this._start},t.prototype.mousedown=function(t,e){this._active=!0,this._start=e},t.prototype.mousemove=function(t,e){if(this._active){var r=e.sub(this._start);return this._start=e,{dragDelta:r,originalEvent:t}}},t.prototype.mouseup=function(t,e){this._active=!1},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),o=n(r(0)),a=function(){function t(t,e){this._map=t,this._handler=e,this._delta=0,this._targetZoom=this._map.transform.zoom}return t.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},t.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},t.prototype.isEnabled=function(){return!!this._enabled},t.prototype.isActive=function(){return!!this._active},t.prototype.reset=function(){this._active=!1},t.prototype.wheel=function(t,e){var r=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=o.default.Browser.now();this._lastEventTime;this._lastEventTime=n,this._delta-=r,this._active||this._start(t),t.preventDefault()},t.prototype._start=function(t){this._active=!0,this._zooming=!0,this._lastEvent=t,this._aroundPoint=new i.Point(t.x,t.y),this._handler.triggerRenderFrame()},t.prototype.renderFrame=function(){return this._onScrollFrame()},t.prototype._onScrollFrame=function(){if(this.isActive()){var t=this._map.transform;if(0!==this._delta){var e=this._delta/100;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,this._targetZoom+e)),this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200),this._delta=0}var r,n="number"==typeof this._targetZoom?this._targetZoom:t.zoom,i=this._startZoom,a=this._easing,s=!1;if(i&&a){var u=Math.min((o.default.Browser.now()-this._lastEventTime)/200,1);r=(n-i)*a(u)+i,u>=1&&(r=n,s=!0)}else r=n,s=!0;return this._active=!0,s&&(this._active=!1,this._handler.triggerRenderFrame(),this._zooming=!1),{renderFrame:!s,targetZoom:r,around:this._aroundPoint,originalEvent:this._lastEvent}}},t.prototype._smoothOutEasing=function(t){var e=o.default.Math.ease;if(this._prevEase){var r=this._prevEase,n=(o.default.Browser.now()-r.start)/r.duration,i=r.easing(n+.01)-r.easing(n),a=.27/Math.sqrt(i*i+1e-4)*.01,s=Math.sqrt(.0729-a*a);e=o.default.Math.bezier(a,s,.25,1)}return this._prevEase={start:o.default.Browser.now(),duration:t,easing:e},e},t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return t.prototype.toArray=function(){return[this.lng,this.lat]},t.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(5)),o=r(2),a=r(6),s=n(r(0)),u=function(){function t(t,e,r,n){this._default=new Array,this.tileSize=i.default.tileSize,this.maxValidLatitude=i.default.maxValidLatitude,this._type=n,this._minZoom=e||i.default.minZoom,this._maxZoom=r||i.default.maxZoom,this.width=t&&t.width,this.height=t&&t.height,this._center=new o.LngLat(108.95,34.26667),this._zoom=14,this._projection=new o.WebMercator,this._bound=this._projection.bound,"2d"===n&&(this._ctx=t.getContext("2d"),this._context=new a.Context(this._ctx)),s.default.Matrix2D.setFromArray(this._default,[256/(this._bound.xmax-this._bound.xmin)*this._bound.xscale,0,0,256/(this._bound.ymax-this._bound.ymin)*this._bound.yscale,this.width/2,this.height/2]),this._matrix=[256*Math.pow(2,this._zoom)/(this._bound.xmax-this._bound.xmin)*this._bound.xscale,0,0,256*Math.pow(2,this._zoom)/(this._bound.ymax-this._bound.ymin)*this._bound.yscale,this.width/2,this.height/2],this.setCenter(this._center),this._ctx.setTransform(1,0,0,1,0,0),this.initTransform()}return Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bound",{get:function(){return this._bound},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenBound",{get:function(){return this._screenBound},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"VBound",{get:function(){return this._vbound},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minZoom",{get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxZoom",{get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},enumerable:!1,configurable:!0}),t.prototype.resize=function(t,e){this.width=t,this.height=e},Object.defineProperty(t.prototype,"center",{get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._center=t,this.setCenter(t))},enumerable:!1,configurable:!0}),t.prototype.setCenter=function(t){var e=this.lngLat2screen(t.toArray());this.moveCenter([this.width/2-e[0],this.height/2-e[1]])},t.prototype.moveCenter=function(t){var e=t[0],r=t[1],n=e/this._matrix[0],i=r/this._matrix[3];s.default.Matrix2D.translate(this._matrix,n,i),this.initTransform()},Object.defineProperty(t.prototype,"anchorPoint",{set:function(t){this._anchorPoint=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._zoom=e,this._scale=this.zoomScale(e),this._tileZoom=Math.floor(e),this.updateZoomMatrix())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoomInt",{get:function(){return Math.floor(this._zoom)},enumerable:!1,configurable:!0}),t.prototype.updateZoomMatrix=function(){var t=this.default,e=this._anchorPoint&&this._anchorPoint.slice()||this.lngLat2screen(this._center.toArray());this._anchorPoint=null;var r=e[0],n=e[1],i=Math.abs(this._scale/(this._matrix[0]/t[0])),o=Math.abs(this._scale/(this._matrix[3]/t[3])),a=this._matrix[4],u=(r-i*(r-a)-a)/this._matrix[0],c=this._matrix[5],h=(n-o*(n-c)-c)/this._matrix[3];s.default.Matrix2D.multiply(this._matrix,Array.from([i,0,0,o,u,h])),this.initTransform()},t.prototype.clearOutTransform=function(){this.initTransform()},t.prototype.clearRect=function(){s.default.Canvas2D.clearRect(this._ctx,0,0,this.width,this.height)},t.prototype.initTransform=function(){this._ctx.fillStyle="#ffffff",this._ctx.fillRect(0,0,this.width,this.height),this.updateVisualBound()},t.prototype.lngLat2Project=function(t){return this._projection.project(t)},t.prototype.project2LngLat=function(t){return this._projection.unproject(t)},t.prototype.project2screen=function(t){return s.default.Matrix2D.transform(this._matrix,t)},t.prototype.screen2project=function(t){return s.default.Matrix2D.invertTransform(this._matrix,t)},t.prototype.lngLat2screen=function(t){return this.project2screen(this.lngLat2Project(t))},t.prototype.screen2lngLat=function(t){return this.project2LngLat(this.screen2project(t))},Object.defineProperty(t.prototype,"default",{get:function(){return s.default.Matrix2D.setFromArray(new Array,this._default)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tileZoom",{get:function(){return this._tileZoom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this._projection},set:function(t){this._projection=t},enumerable:!1,configurable:!0}),t.prototype.zoomScale=function(t){return Math.pow(2,t)},t.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},t.prototype.updateVisualBound=function(){var t=this._matrix,e=t[0],r=(t[1],t[2],t[3]),n=t[4],i=t[5],a=(0-n)/e,s=(0-i)/r,u=(this.width-n)/e,c=(this.height-i)/r;this._vbound=new o.Bound(Math.min(a,u),Math.min(s,c),Math.max(a,u),Math.max(s,c)),this._screenBound=new o.Bound(e*this._bound.xmin*this._bound.xscale+n,r*this._bound.ymin*this._bound.yscale+i,e*this._bound.xmax*this._bound.xscale+n,r*this._bound.ymax*this._bound.yscale+i)},t}();e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._context=t,t instanceof CanvasRenderingContext2D?this.isgl=!1:this.isgl=!0}return Object.defineProperty(t.prototype,"ctx",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gl",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isGl",{get:function(){return this.isgl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCtx",{get:function(){return!this.isgl},enumerable:!1,configurable:!0}),t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._map=e,this._transform=this._map.transform,this._ctx=t}return t.prototype.draw=function(t,e){t||t.point||t.line||t.polygon||this.drawPoint(e,{fillStyle:"red",radius:1,opacity:1}),t.polygon,t.line,t.point&&this.drawPoint(e,t.point)},t.prototype.drawPoint=function(t,e){var r=this;t.forEach((function(t){r._ctx.save(),r._ctx.globalAlpha=e.opacity||1,r._ctx.strokeStyle=e.strokeStyle,r._ctx.fillStyle=e.fillStyle,r._ctx.beginPath(),r._ctx.arc(t[0],t[1],e.radius,0,2*Math.PI,!0),r._ctx.fill(),r._ctx.stroke(),r._ctx.restore()}))},t.prototype.drawLine=function(){},t.prototype.drawPolygon=function(){},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),i=function(){function t(){}return Object.defineProperty(t.prototype,"bound",{get:function(){return new n.Bound(-Math.PI*t.R,Math.PI*t.R,Math.PI*t.R,-Math.PI*t.R)},enumerable:!1,configurable:!0}),t.prototype.project=function(e){var r=e[0],n=e[1],i=Math.PI/180,o=Math.sin(n*i);return[t.R*r*i,t.R*Math.log((1+o)/(1-o))/2]},t.prototype.unproject=function(e){var r=e[0],n=e[1],i=180/Math.PI;return[r*i/t.R,(2*Math.atan(Math.exp(n/t.R))-Math.PI/2)*i]},t.R=6378137,t}();e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,r,n){this._xscale=1,this._yscale=1,this._xmin=Math.min(t,r),this._ymin=Math.min(e,n),this._xmax=Math.max(t,r),this._ymax=Math.max(e,n),this._xscale=t<=r?1:-1,this._yscale=e<=n?1:-1}return Object.defineProperty(t.prototype,"xmin",{get:function(){return this._xmin},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ymin",{get:function(){return this._ymin},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xmax",{get:function(){return this._xmax},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ymax",{get:function(){return this._ymax},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xscale",{get:function(){return this._xscale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yscale",{get:function(){return this._yscale},enumerable:!1,configurable:!0}),t.prototype.containX=function(t){return this._xmin*this._xscale<=t&&this._xmax*this._xscale>=t},t.prototype.containY=function(t){return this._ymin*this._xscale<=t&&this._ymax*this._xscale>=t},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(3),i=r(7),o=function(){function t(t){this._tileSize=256,this.resolutions=[],this._id=t.id,this._url=new i.URL(t.url,t.scheme),this._tileSize=t.tileSize||this._tileSize,this._tilesCache=new n.TilesCache(1e3),this._mapLoadingTile=new Map,this._lstParentTile=new Array,this._lstChildTile=new Array,this._lstCurTile=new Array;for(var e=12756274*Math.PI,r=0;r<23;r++)this.resolutions[r]=e/Math.pow(2,r)}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.refresh=function(){},t.prototype.getData=function(t,e){var r=this,i=t.zoomInt,o=Math.pow(2,i),a=t.width,s=t.height,u=e.xmin,c=e.ymin,h=e.xmax,l=e.ymax,f=h-u,d=l-c,_=Math.floor(o/f*(Math.max(u,0)-u)),p=Math.ceil(o/f*(Math.min(h,a)-u)),m=Math.floor(o/d*(Math.max(c,0)-c)),y=Math.ceil(o/d*(Math.min(l,s)-c));this._lstCurTile.splice(0);for(var v=new Array,b=new Array,g=new Array,x=new Array,w=new Array,M=_;M<p;M++)for(var P=m;P<y;P++){var O=this._url.getUrl(i,M,P),j=this._tileSize*Math.pow(2,t.zoom-i),T=M*j+u,E=P*j+c,A=null;this._mapLoadingTile.has(O)?(A=this._mapLoadingTile.get(O),w.push(O)):this._tilesCache.has(O)?this._lstCurTile.push(this.setTilesTransfrom(this._tilesCache.get(O),T,E,j)):(A=new n.RasterTile(i,M,P,O),g.push(A),this.setTilesTransfrom(A,T,E,j),this._mapLoadingTile.set(A.id,A),w.push(A.id)),this._findParentTile(A).forEach((function(t){x.includes(t.id)||(x.push(t.id),b.push(t))})),this._findChildTiles(A).forEach((function(t){v.push(t)}))}return Array.from(this._mapLoadingTile.keys()).forEach((function(t){w.includes(t)||(r._mapLoadingTile.get(t).destroy(),r._mapLoadingTile.delete(t))})),0===this._mapLoadingTile.size&&(this._lstChildTile.splice(0),this._lstParentTile.splice(0)),b.length>0&&(this._lstParentTile=b),v.length>0&&(this._lstChildTile=v),this._lstParentTile.forEach((function(e){r.setRasterTileTransfrom(e,t,u,c)})),this._lstChildTile.forEach((function(e){r.setRasterTileTransfrom(e,t,u,c)})),g.forEach((function(t){t.load().then((function(t){r._tilesCache.add(t),r._mapLoadingTile.delete(t.id)})).error((function(t){r._mapLoadingTile.delete(t.id),t.destroy()}))})),{tile_cur:this._lstCurTile.slice(),tile_parent:this._lstParentTile.slice().sort((function(t,e){return t.z-e.z})),tile_child:this._lstChildTile.slice()}},t.prototype.getTileViewBound=function(t){var e=t.zoomInt,r=12756274*Math.PI,n=t.VBound,i=t.bound,o=r/Math.pow(2,e),a=Math.floor(Math.abs(n.xmin-i.xmin*i.xscale)%r/o),s=Math.floor(Math.abs(n.ymin-i.ymin*i.yscale)%r/o),u=Math.floor(Math.abs(n.xmax-i.xmin*i.xscale)%r/o),c=Math.floor(Math.abs(n.ymax-i.ymin*i.yscale)%r/o);return console.log({x1:a,y1:s,x2:u,y2:c}),n},t.prototype.absProjectNumber=function(t){},t.prototype.setRasterTileTransfrom=function(t,e,r,n){var i=this._tileSize*Math.pow(2,e.zoom-t.z),o=t.x*i+r,a=t.y*i+n;return this.setTilesTransfrom(t,o,a,i),t},t.prototype.setTilesTransfrom=function(t,e,r,n){return t.transfroms(e,r,n,n),t},t.prototype._findParentTile=function(t){var e=[];if(t)for(var r=t.z,n=t.x,i=t.y,o=1;o<2;o++){var a=r-o;if(a>=0){var s=Math.floor(i/Math.pow(2,o)),u=Math.floor(n/Math.pow(2,o)),c=this._url.getUrl(a,u,s);if(this._tilesCache.has(c)){var h=this._tilesCache.get(c);e.push(h)}}}return e},t.prototype._findChildTiles=function(t){var e=[];if(t)for(var r=t.z,n=t.x,i=t.y,o=1;o<2;o++){var a=r+o;if(r<=22){var s=Math.floor(2*i),u=Math.floor(2*n),c=Math.floor(2*i+1),h=Math.floor(2*n+1),l=this._url.getUrl(a,u,s);if(this._tilesCache.has(l)){var f=this._tilesCache.get(l);e.push(f)}if(l=this._url.getUrl(a,h,s),this._tilesCache.has(l)){f=this._tilesCache.get(l);e.push(f)}if(l=this._url.getUrl(a,u,c),this._tilesCache.has(l)){f=this._tilesCache.get(l);e.push(f)}if(l=this._url.getUrl(a,h,c),this._tilesCache.has(l)){f=this._tilesCache.get(l);e.push(f)}}}return e},t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._url=t,this._scheme=e}return t.prototype.getUrl=function(t,e,r){return this._url.slice().replace("{z}",String(t)).replace("{x}",String(e)).replace("{y}",String("tms"===this._scheme?Math.pow(2,t)-r-1:r))},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(3),i=function(){function t(){this._sources=new Map}return t.prototype.addCreatSource=function(t){var e=null;switch(t.type){case"raster":e=new n.RasterSource(t)}return this._sources.has(e.id)&&console.warn("same of source id,will over old!"),this._sources.set(e.id,e),e},t.prototype.hasSource=function(t){return this._sources.has(t)},t.prototype.getSource=function(t){return this._sources.get(t)},t.prototype.remove=function(t){return this._sources.delete(t),this},t}();e.default=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._max=t,this.reset()}return t.prototype.reset=function(){return this._order=new Array,this._key2tile=new Map,this},t.prototype.clear=function(){this.reset()},t.prototype.add=function(t){var e=t.id;return this.has(e)?(this._order.splice(this._order.indexOf(e),1),this._key2tile.set(e,t),this._order.push(e)):(this._key2tile.set(e,t),this._order.push(e),this._order.length>this._max&&this._key2tile.delete(this._order.splice(0,1)[0])),this},t.prototype.has=function(t){return this._key2tile.has(t)},t.prototype.get=function(t){return this.has(t)?this._key2tile.get(t):null},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),o=n(r(0)),a=function(){function t(t,e,r,n){this._state=i.TileState.NONE,this._dx=0,this._dy=0,this._dw=256,this._dh=256,this._z=t,this._x=e,this._y=r,this._url=n}return t.prototype.transfroms=function(t,e,r,n){this._dx=t,this._dy=e,this._dw=r,this._dh=n},t.prototype.arrayBufferToImageBitmap=function(t){var e=this,r=new window.Blob([new Uint8Array(t)],{type:"image/png"});window.createImageBitmap(r).then((function(t){e._time=o.default.Browser.now(),e._image=t,e._done&&e._done(e),e._state=i.TileState.OK})).catch((function(t){e._state=i.TileState.ERROR,e._error&&e._error(e)}))},t.prototype.arrayBufferToImage=function(t){var e=this,r=window.URL,n=new window.Image;this._image=n,this._image.onerror=function(){e._state=i.TileState.ERROR,e._error&&e._error(e)},this._image.onload=function(){e._time=o.default.Browser.now(),e._done&&e._done(e),e._state=i.TileState.OK,r.revokeObjectURL(n.src)};var a=new window.Blob([new Uint8Array(t)],{type:"image/png"});this._image.src=t.byteLength?r.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="},t.prototype.load=function(){var t=this;this._controller=new window.AbortController;var e=new Headers;e.append("Connection","keep-alive"),e.append("Accept","*/*"),e.append("Accept-Language","zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6");var r=new window.Request(this._url,{method:"GET",headers:e,redirect:"follow",mode:"cors",signal:this._controller.signal});return fetch(this._url,r).then((function(e){e.ok&&e.arrayBuffer().then((function(e){o.default.Browser.offscreenCanvasSupported()?t.arrayBufferToImageBitmap(e):t.arrayBufferToImage(e)}))})).catch((function(e){t._state=i.TileState.ERROR,t._error&&t._error(t)})),this},t.prototype.then=function(t){return this._done=t,this.isLoaded&&this._done(this),this},t.prototype.error=function(t){return this._error=t,this._state===i.TileState.ERROR&&this._error(this),this},t.prototype.destroy=function(){return this._controller.abort(),delete this._z,delete this._x,delete this._y,delete this._done,delete this._error,delete this._dx,delete this._dy,delete this._dw,delete this._dh,delete this._url,delete this._controller,delete this._image,delete this._state,this},Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._state===i.TileState.OK},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFinish",{get:function(){return this._state===i.TileState.OK||this._state===i.TileState.ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xyz",{get:function(){return this._z+"-"+this._x+"-"+this._y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._dx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._dy},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dw",{get:function(){return this._dw},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dh",{get:function(){return this._dh},enumerable:!1,configurable:!0}),t}();e.default=a},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(0)),o=function(){function t(t,e){this._enable=!1,this._transform=e,this._id=t.id,this._sourceId=t.source;var r=i.default.Canvas2D.createCanvas(e.width,e.height);this._canvas=r,this._ctx=r.getContext("2d"),this._enable=!0}return t.prototype.render=function(t){i.default.Canvas2D.clearRect(this._ctx,0,0,this._transform.width,this._transform.height);var e=this._transform.screenBound,r=t.getData(this._transform,e);this.drawImages(r.tile_parent).drawImages(r.tile_child).drawImages(r.tile_cur)},t.prototype.drawImages=function(t){var e=this;return void 0===t&&(t=[]),t.forEach((function(t){e.drawImageOpacity(t)})),this},t.prototype.drawImageOpacity=function(t){var e=t.isLoaded?this.getTileOpacity(t):0,r=this._ctx.globalAlpha;e<1&&(this._ctx.globalAlpha=e),this._ctx.drawImage(t.image,t.dx,t.dy,t.dw,t.dh),this._ctx.globalAlpha!==r&&(this._ctx.globalAlpha=r)},t.prototype.getTileOpacity=function(t){return t.time?Math.min(1,(i.default.Browser.now()-t.time)/(1e3/60*10)):1},t.prototype.draw=function(){this._transform.context.ctx.drawImage(this._canvas,0,0,this._transform.width,this._transform.height)},t.prototype.getSourceId=function(){return this._sourceId},t.prototype.setSourceId=function(t){this._sourceId=t},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.enable=function(){this._enable=!0},t.prototype.disable=function(){this._enable=!1},Object.defineProperty(t.prototype,"isEnable",{get:function(){return this._enable},enumerable:!1,configurable:!0}),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,r){this._enable=!1,this._transform=e,this._id=t.id,this._paint=t.paint,this._sourceId=t.source,this._enable=!0,this._painter=r}return t.prototype.render=function(t){var e=t.getData(this._transform,this._transform.screenBound).coordinates;this._painter.draw(this._paint,e)},t.prototype.draw=function(){},t.prototype.getSourceId=function(){return this._sourceId},t.prototype.setSourceId=function(t){this._sourceId=t},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.enable=function(){this._enable=!0},t.prototype.disable=function(){this._enable=!1},Object.defineProperty(t.prototype,"isEnable",{get:function(){return this._enable},enumerable:!1,configurable:!0}),t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(0)),o=function(){function t(t,e){this._enable=!1,this._transform=e,this._id=t.id,this._sourceId=t.source;var r=i.default.Canvas2D.createCanvas(e.width,e.height);this._canvas=r,this._ctx=r.getContext("2d"),this._enable=!0}return t.prototype.render=function(t){i.default.Canvas2D.clearRect(this._ctx,0,0,this._transform.width,this._transform.height);for(var e=this._transform.screenBound,r=Math.pow(2,this._transform.zoomInt),n=this._transform.width,o=this._transform.height,a=e.xmin,s=e.ymin,u=e.xmax,c=e.ymax,h=u-a,l=c-s,f=Math.floor(r/h*(Math.max(a,0)-a)),d=Math.ceil(r/h*(Math.min(u,n)-a)),_=Math.floor(r/l*(Math.max(s,0)-s)),p=Math.ceil(r/l*(Math.min(c,o)-s)),m=f;m<d;m++)for(var y=_;y<p;y++){var v=256*Math.pow(2,this._transform.zoom-this._transform.zoomInt),b=m*v+a,g=y*v+s;this.drawDebuggerRect(this._transform.zoomInt,m,y,b,g,v,this._ctx)}},t.prototype.drawDebuggerRect=function(t,e,r,n,i,o,a){a.beginPath(),a.strokeStyle="#ff9999",a.fillStyle="#ff9999",a.lineWidth=1,a.rect(n,i,o,o),a.font="30px Verdana",a.fillText("("+t+","+e+","+r+")",n+o/2-100,i+o/2-15,200),a.closePath(),a.stroke()},t.prototype.draw=function(){this._transform.context.ctx.drawImage(this._canvas,0,0,this._transform.width,this._transform.height)},t.prototype.getSourceId=function(){return this._sourceId},t.prototype.setSourceId=function(t){this._sourceId=t},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.enable=function(){this._enable=!0},t.prototype.disable=function(){this._enable=!1},Object.defineProperty(t.prototype,"isEnable",{get:function(){return this._enable},enumerable:!1,configurable:!0}),t}();e.default=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=function(){function t(t,e){this._map=e,this._transform=this._map.transform,this._layers=new Map,this._order=new Array,this._sources=t}return t.prototype.addCreatLayer=function(t,e){var r=null;switch(t.type){case"raster":r=new n.RasterLayer(t,this._transform);break;case"point":r=new n.PointLayer(t,this._transform,this._map._painter);break;case"rasterdebugger":r=new n.RasterDebuggerLayer(t,this._transform)}this._layers.has(r.id)&&(console.warn("same of layer id,will over old!"),this.remove(r.id)),this._layers.set(r.id,r);var i=this._order.indexOf(e);return i>-1?this._order.splice(i,0,e):this._order.push(r.id),r},t.prototype.forEach=function(t){var e=this;return this._order.forEach((function(r){var n=e._layers.get(r);t(n,r)})),this},t.prototype.remove=function(t){return this._layers.delete(t),this._order.splice(this._order.indexOf(t),1),this},t.prototype.render=function(){var t=this;this.forEach((function(e,r){var n=e.getSourceId();if(t._sources.hasSource(n)||"debugger"==n){var i=t._sources.getSource(n);e.render(i)}}))},t.prototype.draw=function(){this.forEach((function(t,e){t.draw()}))},t}();e.default=i},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.TaskQueue=void 0;var i=n(r(42));e.TaskQueue=i.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}return t.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},t.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r++){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},t.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},t.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]},t}();e.default=n}])}));